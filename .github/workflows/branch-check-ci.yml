# This only runs for tags, and the job only processes for "master" branch
name: Tag Example with branch check

on:
  push:
    tags:
      - "*"

jobs:
  # @see https://stackoverflow.com/a/72959712/8179249 # # 
  check-current-branch:
    runs-on: ubuntu-latest
    outputs:
      branch: ${{ steps.check_step.outputs.branch }}
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Get current branch
        id: check_step
        run: |
          git fetch --all --tags
          branch=$(git branch --contains tags/${{ github.ref }} | sed -n 1p | tr -d '[:space:]')
          echo "BRANCH_NAME=$branch" >> $GITHUB_ENV
          echo "Branches where this tag exists : $branch."

      - name: Echo if branch name is main
        if: contains(${{ steps.check_step.outputs.branch }}, 'testbranch')
        run: echo "${{ steps.check_step.outputs.branch }}"

